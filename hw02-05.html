<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shashwat Singh">
<meta name="description" content="Correlating Like a Data Master: Assess relationships within a novel data set using publication quality tables and plots.">

<title>hw02-05</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="hw02-05_files/libs/clipboard/clipboard.min.js"></script>
<script src="hw02-05_files/libs/quarto-html/quarto.js"></script>
<script src="hw02-05_files/libs/quarto-html/popper.min.js"></script>
<script src="hw02-05_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="hw02-05_files/libs/quarto-html/anchor.min.js"></script>
<link href="hw02-05_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="hw02-05_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="hw02-05_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="hw02-05_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="hw02-05_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">hw02-05</h1>
</div>

<div>
  <div class="description">
    Correlating Like a Data Master: Assess relationships within a novel data set using publication quality tables and plots.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Shashwat Singh </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="correlating-like-a-data-master" class="level1">
<h1>Correlating Like a Data Master</h1>
</section>
<section id="required-setup" class="level1">
<h1><strong>Required setup</strong></h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(pacman))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: pacman</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(colorblindr,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>       dlookr,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>       formattable,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>       GGally,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>       ggdist,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>       ggpubr,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>       ggridges,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>       here,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>       tidyverse)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Set global ggplot() theme</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Theme pub_clean() from the ggpubr package with base text size = 16</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_pubclean</span>(<span class="at">base_size =</span> <span class="dv">12</span>)) </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># All axes titles to their respective far right sides</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_update</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove axes ticks</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_update</span>(<span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()) </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove legend key</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_update</span>(<span class="at">legend.key =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-and-examine-a-data-set" class="level1">
<h1>Load and Examine a Data Set</h1>
<p>Using the dataset from tidyurl- The dataset contains stock prices of big tech companies and tries to analyse the collapse of “Big Tech” stock prices. The data comes from Yahoo Finance via Kaggle</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading the dataset</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/big_tech_stock_prices.csv"</span>) </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Formattable data</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formattable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:right;">
stock_symbol
</th>
<th style="text-align:right;">
date
</th>
<th style="text-align:right;">
open
</th>
<th style="text-align:right;">
high
</th>
<th style="text-align:right;">
low
</th>
<th style="text-align:right;">
close
</th>
<th style="text-align:right;">
adj_close
</th>
<th style="text-align:right;">
volume
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
AAPL
</td>
<td style="text-align:right;">
2010-01-04
</td>
<td style="text-align:right;">
7.622500
</td>
<td style="text-align:right;">
7.660714
</td>
<td style="text-align:right;">
7.585000
</td>
<td style="text-align:right;">
7.643214
</td>
<td style="text-align:right;">
6.515213
</td>
<td style="text-align:right;">
493729600
</td>
</tr>
<tr>
<td style="text-align:right;">
AAPL
</td>
<td style="text-align:right;">
2010-01-05
</td>
<td style="text-align:right;">
7.664286
</td>
<td style="text-align:right;">
7.699643
</td>
<td style="text-align:right;">
7.616071
</td>
<td style="text-align:right;">
7.656429
</td>
<td style="text-align:right;">
6.526476
</td>
<td style="text-align:right;">
601904800
</td>
</tr>
<tr>
<td style="text-align:right;">
AAPL
</td>
<td style="text-align:right;">
2010-01-06
</td>
<td style="text-align:right;">
7.656429
</td>
<td style="text-align:right;">
7.686786
</td>
<td style="text-align:right;">
7.526786
</td>
<td style="text-align:right;">
7.534643
</td>
<td style="text-align:right;">
6.422664
</td>
<td style="text-align:right;">
552160000
</td>
</tr>
<tr>
<td style="text-align:right;">
AAPL
</td>
<td style="text-align:right;">
2010-01-07
</td>
<td style="text-align:right;">
7.562500
</td>
<td style="text-align:right;">
7.571429
</td>
<td style="text-align:right;">
7.466071
</td>
<td style="text-align:right;">
7.520714
</td>
<td style="text-align:right;">
6.410790
</td>
<td style="text-align:right;">
477131200
</td>
</tr>
<tr>
<td style="text-align:right;">
AAPL
</td>
<td style="text-align:right;">
2010-01-08
</td>
<td style="text-align:right;">
7.510714
</td>
<td style="text-align:right;">
7.571429
</td>
<td style="text-align:right;">
7.466429
</td>
<td style="text-align:right;">
7.570714
</td>
<td style="text-align:right;">
6.453412
</td>
<td style="text-align:right;">
447610800
</td>
</tr>
<tr>
<td style="text-align:right;">
AAPL
</td>
<td style="text-align:right;">
2010-01-11
</td>
<td style="text-align:right;">
7.600000
</td>
<td style="text-align:right;">
7.607143
</td>
<td style="text-align:right;">
7.444643
</td>
<td style="text-align:right;">
7.503929
</td>
<td style="text-align:right;">
6.396483
</td>
<td style="text-align:right;">
462229600
</td>
</tr>
</tbody>

</table>
</div>
</div>
</section>
<section id="describe-and-visualize-correlations" class="level1">
<h1>Describe and Visualize Correlations</h1>
<p>Correlations are a statistical relationship between two numerical variables, may or may not be causal. Exploring correlations in your data allows you determine data independence, a major assumption of parametric statistics, which means your variables are both randomly collected.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table of correlations between numerical variables (we are sticking to the default Pearson's r coefficient)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">correlate</span>(dataset) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formattable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:right;">
var1
</th>
<th style="text-align:right;">
var2
</th>
<th style="text-align:right;">
coef_corr
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
high
</td>
<td style="text-align:right;">
open
</td>
<td style="text-align:right;">
0.9998560
</td>
</tr>
<tr>
<td style="text-align:right;">
low
</td>
<td style="text-align:right;">
open
</td>
<td style="text-align:right;">
0.9998267
</td>
</tr>
<tr>
<td style="text-align:right;">
close
</td>
<td style="text-align:right;">
open
</td>
<td style="text-align:right;">
0.9996772
</td>
</tr>
<tr>
<td style="text-align:right;">
adj_close
</td>
<td style="text-align:right;">
open
</td>
<td style="text-align:right;">
0.9944807
</td>
</tr>
<tr>
<td style="text-align:right;">
volume
</td>
<td style="text-align:right;">
open
</td>
<td style="text-align:right;">
-0.2245188
</td>
</tr>
<tr>
<td style="text-align:right;">
open
</td>
<td style="text-align:right;">
high
</td>
<td style="text-align:right;">
0.9998560
</td>
</tr>
<tr>
<td style="text-align:right;">
low
</td>
<td style="text-align:right;">
high
</td>
<td style="text-align:right;">
0.9997612
</td>
</tr>
<tr>
<td style="text-align:right;">
close
</td>
<td style="text-align:right;">
high
</td>
<td style="text-align:right;">
0.9998365
</td>
</tr>
<tr>
<td style="text-align:right;">
adj_close
</td>
<td style="text-align:right;">
high
</td>
<td style="text-align:right;">
0.9948710
</td>
</tr>
<tr>
<td style="text-align:right;">
volume
</td>
<td style="text-align:right;">
high
</td>
<td style="text-align:right;">
-0.2233435
</td>
</tr>
<tr>
<td style="text-align:right;">
open
</td>
<td style="text-align:right;">
low
</td>
<td style="text-align:right;">
0.9998267
</td>
</tr>
<tr>
<td style="text-align:right;">
high
</td>
<td style="text-align:right;">
low
</td>
<td style="text-align:right;">
0.9997612
</td>
</tr>
<tr>
<td style="text-align:right;">
close
</td>
<td style="text-align:right;">
low
</td>
<td style="text-align:right;">
0.9998407
</td>
</tr>
<tr>
<td style="text-align:right;">
adj_close
</td>
<td style="text-align:right;">
low
</td>
<td style="text-align:right;">
0.9943504
</td>
</tr>
<tr>
<td style="text-align:right;">
volume
</td>
<td style="text-align:right;">
low
</td>
<td style="text-align:right;">
-0.2260704
</td>
</tr>
<tr>
<td style="text-align:right;">
open
</td>
<td style="text-align:right;">
close
</td>
<td style="text-align:right;">
0.9996772
</td>
</tr>
<tr>
<td style="text-align:right;">
high
</td>
<td style="text-align:right;">
close
</td>
<td style="text-align:right;">
0.9998365
</td>
</tr>
<tr>
<td style="text-align:right;">
low
</td>
<td style="text-align:right;">
close
</td>
<td style="text-align:right;">
0.9998407
</td>
</tr>
<tr>
<td style="text-align:right;">
adj_close
</td>
<td style="text-align:right;">
close
</td>
<td style="text-align:right;">
0.9947827
</td>
</tr>
<tr>
<td style="text-align:right;">
volume
</td>
<td style="text-align:right;">
close
</td>
<td style="text-align:right;">
-0.2246948
</td>
</tr>
<tr>
<td style="text-align:right;">
open
</td>
<td style="text-align:right;">
adj_close
</td>
<td style="text-align:right;">
0.9944807
</td>
</tr>
<tr>
<td style="text-align:right;">
high
</td>
<td style="text-align:right;">
adj_close
</td>
<td style="text-align:right;">
0.9948710
</td>
</tr>
<tr>
<td style="text-align:right;">
low
</td>
<td style="text-align:right;">
adj_close
</td>
<td style="text-align:right;">
0.9943504
</td>
</tr>
<tr>
<td style="text-align:right;">
close
</td>
<td style="text-align:right;">
adj_close
</td>
<td style="text-align:right;">
0.9947827
</td>
</tr>
<tr>
<td style="text-align:right;">
volume
</td>
<td style="text-align:right;">
adj_close
</td>
<td style="text-align:right;">
-0.2134037
</td>
</tr>
<tr>
<td style="text-align:right;">
open
</td>
<td style="text-align:right;">
volume
</td>
<td style="text-align:right;">
-0.2245188
</td>
</tr>
<tr>
<td style="text-align:right;">
high
</td>
<td style="text-align:right;">
volume
</td>
<td style="text-align:right;">
-0.2233435
</td>
</tr>
<tr>
<td style="text-align:right;">
low
</td>
<td style="text-align:right;">
volume
</td>
<td style="text-align:right;">
-0.2260704
</td>
</tr>
<tr>
<td style="text-align:right;">
close
</td>
<td style="text-align:right;">
volume
</td>
<td style="text-align:right;">
-0.2246948
</td>
</tr>
<tr>
<td style="text-align:right;">
adj_close
</td>
<td style="text-align:right;">
volume
</td>
<td style="text-align:right;">
-0.2134037
</td>
</tr>
</tbody>

</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_correlate</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw02-05_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The variable’s correlation is very high and it makes sense. This is because the variables open, low, high and close of a stock price do not change a lot for a particular day and very close to each other. This will be visible throughout the various correlation operations below.</p>
</section>
<section id="visualize-correlations-within-groups" class="level1">
<h1>Visualize Correlations within Groups</h1>
<p>If we have groups that we will compare later on, it is a good idea to see how each numerical variable correlates within these groups.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> dataset <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">OpenGroup =</span> <span class="fu">ifelse</span>(open <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> open <span class="sc">&lt;=</span> <span class="dv">10</span>, <span class="st">"LowOpen"</span>, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(open <span class="sc">&gt;</span> <span class="dv">10</span> <span class="sc">&amp;</span> open <span class="sc">&lt;=</span> <span class="dv">100</span>, <span class="st">"MediumOpen"</span>, <span class="st">"HighOpen"</span>))</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(OpenGroup) <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_correlate</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: 'plot_correlate' is deprecated.
Use 'plot.correlate' instead.
See help("Deprecated")</code></pre>
</div>
<div class="cell-output-display">
<p><img src="hw02-05_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="hw02-05_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="hw02-05_files/figure-html/unnamed-chunk-6-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This is great, we have our correlations within groups! However, the correlation matrices aren’t always the most intuitive, so let’s plot!</p>
<p>We will be using the ggpairs() function within the GGally package. Specifically, we are looking at the correlations between predawn leaf water potential pLWP and midday leaf water potential mLWP. Leaf water potential is a key indicator for how stressed plants are in droughts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(OpenGroup, low, high) <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(<span class="fu">aes</span>(<span class="at">color =</span> OpenGroup, <span class="at">alpha =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="hw02-05_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="describe-and-visualize-relationships-based-on-target-variables" class="level1">
<h1>Describe and Visualize Relationships Based on Target Variables</h1>
<section id="target-variables" class="level2">
<h2 class="anchored" data-anchor-id="target-variables">Target Variables</h2>
<p>Target variables are essentially numerical or categorical variables that you want to relate others to in a data frame. dlookr does this through the target_by() function, which is similar to group_by() in dplyr. The relate() function then briefly analyzes the relationship between the target variable and the variables of interest.</p>
<p>The relationships below will have the formula relationship target ~ predictor</p>
<p>Numerical Target Variables: Numerical Variable of Interest Formula: Sap_Flow (numerical response) ~ pLWP (numerical predictor)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, we need to remove NAs, they cause an error</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>dataset.noNA <span class="ot">&lt;-</span> dataset <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The numerical predictor variable that we want</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>num <span class="ot">&lt;-</span> <span class="fu">target_by</span>(dataset.noNA, close)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Relating the variable of interest to the numerical target variable</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>num_num <span class="ot">&lt;-</span> <span class="fu">relate</span>(num, open)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of the regression analysis - the same as the summary from lm(Formula)</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(num_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = formula_str, data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-49.840  -0.372  -0.032   0.373  55.290 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 0.0634242  0.0161787    3.92 8.86e-05 ***
open        0.9993424  0.0001196 8355.10  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.581 on 45086 degrees of freedom
Multiple R-squared:  0.9994,    Adjusted R-squared:  0.9994 
F-statistic: 6.981e+07 on 1 and 45086 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting the linear relationship</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(num_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw02-05_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="numerical-target-variables-categorical-variable-of-interest" class="level2">
<h2 class="anchored" data-anchor-id="numerical-target-variables-categorical-variable-of-interest">Numerical Target Variables: Categorical Variable of Interest</h2>
<p>Formula: pLWP (numerical response) ~ Group (categorical predictor)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The categorical predictor variable that we want</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>num <span class="ot">&lt;-</span> <span class="fu">target_by</span>(dataset, stock_symbol) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in target_by_impl(.data, vars): The target variable was assigned a
character type.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to change Group to a factor</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>num<span class="sc">$</span>OpenGroup <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(num<span class="sc">$</span>OpenGroup)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Relating the variable of interest to the numerical target variable</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>num_cat <span class="ot">&lt;-</span> <span class="fu">relate</span>(num, OpenGroup)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of the ANOVA analysis - the same as the summary from anova(lm(Formula))</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(num_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: xtabs(formula = formula_str, data = data, addNA = TRUE)
Number of cases in table: 45088 
Number of factors: 2 
Test for independence of all factors:
    Chisq = 28888, df = 26, p-value = 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(num_cat) <span class="sc">+</span> </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: This manual palette can handle a maximum of 9 values. You have
supplied 14.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="hw02-05_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="categorical-target-variables-numerical-variable-of-interest" class="level2">
<h2 class="anchored" data-anchor-id="categorical-target-variables-numerical-variable-of-interest">Categorical Target Variables: Numerical Variable of Interest</h2>
<p>Note that this produces descriptive statistics, unlike the other relationships we are looking at.</p>
<p>Formula: Group (categorical) ~ pLWP (numerical)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The categorical predictor variable that we want</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>categ <span class="ot">&lt;-</span> <span class="fu">target_by</span>(dataset, OpenGroup)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Relating the variable of interest to the numerical target variable</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>cat_num <span class="ot">&lt;-</span> <span class="fu">relate</span>(categ, close)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of descriptive statistics</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cat_num)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> described_variables  OpenGroup               n               na   
 Length:4            Length:4           Min.   : 3255   Min.   :0  
 Class :character    Class :character   1st Qu.:11140   1st Qu.:0  
 Mode  :character    Mode  :character   Median :20916   Median :0  
                                        Mean   :22544   Mean   :0  
                                        3rd Qu.:32321   3rd Qu.:0  
                                        Max.   :45088   Max.   :0  
      mean               sd             se_mean             IQR         
 Min.   :  4.989   Min.   :  2.626   Min.   :0.04603   Min.   :  4.277  
 1st Qu.: 31.606   1st Qu.: 16.747   1st Qu.:0.10755   1st Qu.: 22.654  
 Median : 64.875   Median : 61.523   Median :0.30325   Median : 65.880  
 Mean   : 85.849   Mean   : 58.889   Mean   :0.39725   Mean   : 61.753  
 3rd Qu.:119.118   3rd Qu.:103.666   3rd Qu.:0.59295   3rd Qu.:104.979  
 Max.   :208.659   Max.   :109.884   Max.   :0.93648   Max.   :110.975  
    skewness         kurtosis            p00              p01         
 Min.   :0.4737   Min.   :-1.0795   Min.   : 1.053   Min.   :  1.346  
 1st Qu.:0.7586   1st Qu.:-0.2504   1st Qu.: 1.053   1st Qu.:  1.877  
 Median :1.3457   Median : 1.6672   Median : 5.316   Median :  6.657  
 Mean   :1.3712   Mean   : 2.2177   Mean   :26.659   Mean   : 29.191  
 3rd Qu.:1.9583   3rd Qu.: 4.1354   3rd Qu.:30.921   3rd Qu.: 33.972  
 Max.   :2.3197   Max.   : 6.6161   Max.   :94.950   Max.   :102.102  
      p05               p10               p20               p25        
 Min.   :  1.648   Min.   :  1.885   Min.   :  2.353   Min.   :  2.99  
 1st Qu.:  5.131   1st Qu.: 10.598   1st Qu.: 16.841   1st Qu.: 18.82  
 Median : 10.044   Median : 14.788   Median : 21.773   Median : 24.88  
 Mean   : 32.996   Mean   : 37.409   Mean   : 44.183   Mean   : 47.29  
 3rd Qu.: 37.908   3rd Qu.: 41.598   3rd Qu.: 49.116   3rd Qu.: 53.35  
 Max.   :110.247   Max.   :118.174   Max.   :130.834   Max.   :136.41  
      p30               p40               p50               p60         
 Min.   :  3.183   Min.   :  3.663   Min.   :  4.343   Min.   :  5.043  
 1st Qu.: 20.483   1st Qu.: 23.675   1st Qu.: 27.553   1st Qu.: 32.784  
 Median : 27.490   Median : 33.671   Median : 41.630   Median : 52.481  
 Mean   : 49.804   Mean   : 56.038   Mean   : 63.771   Mean   : 73.796  
 3rd Qu.: 56.811   3rd Qu.: 66.034   3rd Qu.: 77.848   3rd Qu.: 93.494  
 Max.   :141.052   Max.   :153.149   Max.   :167.482   Max.   :185.180  
      p70               p75               p80               p90        
 Min.   :  6.366   Min.   :  7.267   Min.   :  8.132   Min.   :  9.14  
 1st Qu.: 38.206   1st Qu.: 41.477   1st Qu.: 44.632   1st Qu.: 57.75  
 Median : 76.295   Median : 90.760   Median :101.596   Median :141.24  
 Mean   : 95.238   Mean   :109.043   Mean   :121.519   Mean   :161.61  
 3rd Qu.:133.326   3rd Qu.:158.327   3rd Qu.:178.484   3rd Qu.:245.10  
 Max.   :221.995   Max.   :247.385   Max.   :274.754   Max.   :354.83  
      p95               p99              p100       
 Min.   :  9.482   Min.   :  9.96   Min.   : 11.32  
 1st Qu.: 67.202   1st Qu.: 74.99   1st Qu.: 80.89  
 Median :191.396   Median :302.22   Median :397.88  
 Mean   :217.031   Mean   :306.63   Mean   :374.69  
 3rd Qu.:341.224   3rd Qu.:533.86   3rd Qu.:691.69  
 Max.   :475.851   Max.   :612.15   Max.   :691.69  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cat_num) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw02-05_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="categorical-target-variables-categorical-variable-of-interest" class="level2">
<h2 class="anchored" data-anchor-id="categorical-target-variables-categorical-variable-of-interest">Categorical Target Variables: Categorical Variable of Interest</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create new categorical column</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>cat_dataset <span class="ot">&lt;-</span> dataset <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(close, OpenGroup) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">HighClose =</span> <span class="fu">ifelse</span>(</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    close <span class="sc">&gt;</span> (<span class="fu">mean</span>(close <span class="sc">+</span> <span class="fu">sd</span>(close))), </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"Yes"</span>, </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                          <span class="st">"No"</span>))</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># New dataset </span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>cat_dataset <span class="sc">|&gt;</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">|&gt;</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formattable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:right;">
close
</th>
<th style="text-align:right;">
OpenGroup
</th>
<th style="text-align:right;">
HighClose
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
7.643214
</td>
<td style="text-align:right;">
LowOpen
</td>
<td style="text-align:right;">
No
</td>
</tr>
<tr>
<td style="text-align:right;">
7.656429
</td>
<td style="text-align:right;">
LowOpen
</td>
<td style="text-align:right;">
No
</td>
</tr>
<tr>
<td style="text-align:right;">
7.534643
</td>
<td style="text-align:right;">
LowOpen
</td>
<td style="text-align:right;">
No
</td>
</tr>
<tr>
<td style="text-align:right;">
7.520714
</td>
<td style="text-align:right;">
LowOpen
</td>
<td style="text-align:right;">
No
</td>
</tr>
<tr>
<td style="text-align:right;">
7.570714
</td>
<td style="text-align:right;">
LowOpen
</td>
<td style="text-align:right;">
No
</td>
</tr>
<tr>
<td style="text-align:right;">
7.503929
</td>
<td style="text-align:right;">
LowOpen
</td>
<td style="text-align:right;">
No
</td>
</tr>
</tbody>

</table>
</div>
</div>
<p>Now we have two categories!</p>
<p>Formula = HighClose (categorical) ~ OpenGroup (categorical response)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The categorical predictor variable that we want</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>categ <span class="ot">&lt;-</span> <span class="fu">target_by</span>(cat_dataset, HighClose)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Relating the variable of interest to the categorical target variable</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>cat_cat <span class="ot">&lt;-</span> <span class="fu">relate</span>(categ, OpenGroup)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary of the Chi-square test for Independence</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cat_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Call: xtabs(formula = formula_str, data = data, addNA = TRUE)
Number of cases in table: 45088 
Number of factors: 2 
Test for independence of all factors:
    Chisq = 13191, df = 2, p-value = 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cat_cat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw02-05_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>