<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shashwat Singh">
<meta name="description" content="Imputing like a Data Scientist: Exploring, visualizing, and imputing outliers and missing values (NAs) in a novel data set and produce publication quality graphs and tables.">

<title>hw02-04</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="hw02-04_files/libs/clipboard/clipboard.min.js"></script>
<script src="hw02-04_files/libs/quarto-html/quarto.js"></script>
<script src="hw02-04_files/libs/quarto-html/popper.min.js"></script>
<script src="hw02-04_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="hw02-04_files/libs/quarto-html/anchor.min.js"></script>
<link href="hw02-04_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="hw02-04_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="hw02-04_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="hw02-04_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="hw02-04_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">hw02-04</h1>
</div>

<div>
  <div class="description">
    Imputing like a Data Scientist: Exploring, visualizing, and imputing outliers and missing values (NAs) in a novel data set and produce publication quality graphs and tables.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Shashwat Singh </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="imputing-like-a-data-scientist" class="level1">
<h1><strong>Imputing like a Data Scientist</strong></h1>
</section>
<section id="install-required-packages-and-environment-setup" class="level1">
<h1>Install Required Packages and Environment Setup</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sets the number of significant figures to two - e.g., 0.01</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Required package for quick package downloading and loading </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(pacman))</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: pacman</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(colorblindr, <span class="co"># Colorblind friendly pallettes</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>               cluster, <span class="co"># K cluster analyses</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>               dlookr, <span class="co"># Exploratory data analysis</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>               formattable, <span class="co"># HTML tables from R outputs</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>               ggfortify, <span class="co"># Plotting tools for stats</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>               ggpubr, <span class="co"># Publishable ggplots</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>               here, <span class="co"># Standardizes paths to data</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>               kableExtra, <span class="co"># Alternative to formattable</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>               knitr, <span class="co"># Needed to write HTML reports</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>               missRanger, <span class="co"># To generate NAs</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>               plotly, <span class="co"># Visualization package</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>               rattle, <span class="co"># Decision tree visualization</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>               rpart, <span class="co"># rpart algorithm</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>               tidyverse, <span class="co"># Powerful data wrangling package suite</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>               visdat) <span class="co"># Another EDA visualization package</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># I was having issues with installing colorblindr so I skipped it</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Set global ggplot() theme</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Theme pub_clean() from the ggpubr package with base text size = 16</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_pubclean</span>(<span class="at">base_size =</span> <span class="dv">16</span>)) </span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># All axes titles to their respective far right sides</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_update</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove axes ticks</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_update</span>(<span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()) </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove legend key</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_update</span>(<span class="at">legend.key =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-and-examine-a-data-set" class="level1">
<h1>Load and Examine a Data Set</h1>
<ul>
<li>Load data and view</li>
<li>Examine columns and data types</li>
<li>Define box plots</li>
<li>Describe meta data</li>
</ul>
<p>Using the dataset from tidyurl- The dataset contains stock prices of big tech companies and tries to analyse the collapse of “Big Tech” stock prices. The data comes from Yahoo Finance via Kaggle</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loading the dataset</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/big_tech_stock_prices.csv"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">OpenGroup =</span> <span class="fu">ifelse</span>(open <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> open <span class="sc">&lt;=</span> <span class="dv">10</span>, <span class="st">"LowOpen"</span>, </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">ifelse</span>(open <span class="sc">&gt;</span> <span class="dv">10</span> <span class="sc">&amp;</span> open <span class="sc">&lt;=</span> <span class="dv">100</span>, <span class="st">"MediumOpen"</span>, <span class="st">"HighOpen"</span>))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Formattable data</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formattable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:right;">
stock_symbol
</th>
<th style="text-align:right;">
date
</th>
<th style="text-align:right;">
open
</th>
<th style="text-align:right;">
high
</th>
<th style="text-align:right;">
low
</th>
<th style="text-align:right;">
close
</th>
<th style="text-align:right;">
adj_close
</th>
<th style="text-align:right;">
volume
</th>
<th style="text-align:right;">
OpenGroup
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
AAPL
</td>
<td style="text-align:right;">
2010-01-04
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
6.5
</td>
<td style="text-align:right;">
493729600
</td>
<td style="text-align:right;">
LowOpen
</td>
</tr>
<tr>
<td style="text-align:right;">
AAPL
</td>
<td style="text-align:right;">
2010-01-05
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
6.5
</td>
<td style="text-align:right;">
601904800
</td>
<td style="text-align:right;">
LowOpen
</td>
</tr>
<tr>
<td style="text-align:right;">
AAPL
</td>
<td style="text-align:right;">
2010-01-06
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
6.4
</td>
<td style="text-align:right;">
552160000
</td>
<td style="text-align:right;">
LowOpen
</td>
</tr>
<tr>
<td style="text-align:right;">
AAPL
</td>
<td style="text-align:right;">
2010-01-07
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
6.4
</td>
<td style="text-align:right;">
477131200
</td>
<td style="text-align:right;">
LowOpen
</td>
</tr>
<tr>
<td style="text-align:right;">
AAPL
</td>
<td style="text-align:right;">
2010-01-08
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
6.5
</td>
<td style="text-align:right;">
447610800
</td>
<td style="text-align:right;">
LowOpen
</td>
</tr>
<tr>
<td style="text-align:right;">
AAPL
</td>
<td style="text-align:right;">
2010-01-11
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
7.4
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
6.4
</td>
<td style="text-align:right;">
462229600
</td>
<td style="text-align:right;">
LowOpen
</td>
</tr>
</tbody>

</table>
</div>
</div>
</section>
<section id="diagnose-your-data" class="level1">
<h1>Diagnose your Data</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Properties of the data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diagnose</span>() <span class="sc">|&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formattable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:right;">
variables
</th>
<th style="text-align:right;">
types
</th>
<th style="text-align:right;">
missing_count
</th>
<th style="text-align:right;">
missing_percent
</th>
<th style="text-align:right;">
unique_count
</th>
<th style="text-align:right;">
unique_rate
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
stock_symbol
</td>
<td style="text-align:right;">
character
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
14
</td>
<td style="text-align:right;">
3.1e-04
</td>
</tr>
<tr>
<td style="text-align:right;">
date
</td>
<td style="text-align:right;">
character
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3287
</td>
<td style="text-align:right;">
7.3e-02
</td>
</tr>
<tr>
<td style="text-align:right;">
open
</td>
<td style="text-align:right;">
numeric
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
29798
</td>
<td style="text-align:right;">
6.6e-01
</td>
</tr>
<tr>
<td style="text-align:right;">
high
</td>
<td style="text-align:right;">
numeric
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
30056
</td>
<td style="text-align:right;">
6.7e-01
</td>
</tr>
<tr>
<td style="text-align:right;">
low
</td>
<td style="text-align:right;">
numeric
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
30028
</td>
<td style="text-align:right;">
6.7e-01
</td>
</tr>
<tr>
<td style="text-align:right;">
close
</td>
<td style="text-align:right;">
numeric
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
30965
</td>
<td style="text-align:right;">
6.9e-01
</td>
</tr>
<tr>
<td style="text-align:right;">
adj_close
</td>
<td style="text-align:right;">
numeric
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
41279
</td>
<td style="text-align:right;">
9.2e-01
</td>
</tr>
<tr>
<td style="text-align:right;">
volume
</td>
<td style="text-align:right;">
integer
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
43550
</td>
<td style="text-align:right;">
9.7e-01
</td>
</tr>
<tr>
<td style="text-align:right;">
OpenGroup
</td>
<td style="text-align:right;">
character
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
6.7e-05
</td>
</tr>
</tbody>

</table>
</div>
</div>
<ul>
<li><p><code>variables</code>: name of each variable</p></li>
<li><p><code>types</code>: data type of each variable</p></li>
<li><p><code>missing_count</code>: number of missing values</p></li>
<li><p><code>missing_percent</code>: percentage of missing values</p></li>
<li><p><code>unique_count</code>: number of unique values</p></li>
<li><p><code>unique_rate</code>: rate of unique value - unique_count / number of observations</p></li>
</ul>
</section>
<section id="diagnose-outliers" class="level1">
<h1><strong>Diagnose Outliers</strong></h1>
<p>There are several numerical variables that have outliers above, let’s see what the data look like with and without them</p>
<ul>
<li><p>Create a table with columns containing outliers</p></li>
<li><p>Plot outliers in a box plot and histogram</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table showing outliers</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">diagnose_outlier</span>() <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(outliers_ratio <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rate =</span> outliers_mean <span class="sc">/</span> with_mean) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(rate)) <span class="sc">|&gt;</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>outliers_cnt) <span class="sc">|&gt;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formattable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:right;">
variables
</th>
<th style="text-align:right;">
outliers_ratio
</th>
<th style="text-align:right;">
outliers_mean
</th>
<th style="text-align:right;">
with_mean
</th>
<th style="text-align:right;">
without_mean
</th>
<th style="text-align:right;">
rate
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
volume
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
2.9e+08
</td>
<td style="text-align:right;">
5.3e+07
</td>
<td style="text-align:right;">
3.3e+07
</td>
<td style="text-align:right;">
5.5
</td>
</tr>
<tr>
<td style="text-align:right;">
low
</td>
<td style="text-align:right;">
5.6
</td>
<td style="text-align:right;">
4.0e+02
</td>
<td style="text-align:right;">
8.8e+01
</td>
<td style="text-align:right;">
7.0e+01
</td>
<td style="text-align:right;">
4.5
</td>
</tr>
<tr>
<td style="text-align:right;">
open
</td>
<td style="text-align:right;">
5.7
</td>
<td style="text-align:right;">
4.0e+02
</td>
<td style="text-align:right;">
8.9e+01
</td>
<td style="text-align:right;">
7.1e+01
</td>
<td style="text-align:right;">
4.5
</td>
</tr>
<tr>
<td style="text-align:right;">
close
</td>
<td style="text-align:right;">
5.7
</td>
<td style="text-align:right;">
4.0e+02
</td>
<td style="text-align:right;">
8.9e+01
</td>
<td style="text-align:right;">
7.1e+01
</td>
<td style="text-align:right;">
4.5
</td>
</tr>
<tr>
<td style="text-align:right;">
high
</td>
<td style="text-align:right;">
5.8
</td>
<td style="text-align:right;">
4.0e+02
</td>
<td style="text-align:right;">
9.0e+01
</td>
<td style="text-align:right;">
7.1e+01
</td>
<td style="text-align:right;">
4.5
</td>
</tr>
<tr>
<td style="text-align:right;">
adj_close
</td>
<td style="text-align:right;">
7.4
</td>
<td style="text-align:right;">
3.7e+02
</td>
<td style="text-align:right;">
8.5e+01
</td>
<td style="text-align:right;">
6.3e+01
</td>
<td style="text-align:right;">
4.3
</td>
</tr>
</tbody>

</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplots and histograms of data with and without outliers</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">find_outliers</span>(dataset)) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">plot_outlier</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw02-04_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="hw02-04_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="hw02-04_files/figure-html/unnamed-chunk-5-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="hw02-04_files/figure-html/unnamed-chunk-5-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="hw02-04_files/figure-html/unnamed-chunk-5-5.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Plots for all variables are shifting towards normality without outliers.</p>
</section>
<section id="basic-exploration-of-missing-values-nas" class="level1">
<h1><strong>Basic Exploration of Missing Values (NAs)</strong></h1>
<ul>
<li>Table showing the extent of NAs in columns containing them</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomly generate NAs for 30</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>na.dataset <span class="ot">&lt;-</span> dataset <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">generateNA</span>(<span class="at">p =</span> <span class="fl">0.3</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># First six rows</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>na.dataset <span class="sc">|&gt;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formattable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:right;">
stock_symbol
</th>
<th style="text-align:right;">
date
</th>
<th style="text-align:right;">
open
</th>
<th style="text-align:right;">
high
</th>
<th style="text-align:right;">
low
</th>
<th style="text-align:right;">
close
</th>
<th style="text-align:right;">
adj_close
</th>
<th style="text-align:right;">
volume
</th>
<th style="text-align:right;">
OpenGroup
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2010-01-04
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
6.5
</td>
<td style="text-align:right;">
493729600
</td>
<td style="text-align:right;">
LowOpen
</td>
</tr>
<tr>
<td style="text-align:right;">
AAPL
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
6.5
</td>
<td style="text-align:right;">
601904800
</td>
<td style="text-align:right;">
LowOpen
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2010-01-06
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
7.7
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
6.4
</td>
<td style="text-align:right;">
552160000
</td>
<td style="text-align:right;">
LowOpen
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2010-01-07
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
6.4
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
LowOpen
</td>
</tr>
<tr>
<td style="text-align:right;">
AAPL
</td>
<td style="text-align:right;">
2010-01-08
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
LowOpen
</td>
</tr>
<tr>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
2010-01-11
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7.6
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
7.5
</td>
<td style="text-align:right;">
6.4
</td>
<td style="text-align:right;">
462229600
</td>
<td style="text-align:right;">
LowOpen
</td>
</tr>
</tbody>

</table>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the NA table</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>na.dataset <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_na_pareto</span>(<span class="at">only_na =</span> <span class="cn">TRUE</span>, <span class="at">plot =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">formattable</span>() <span class="co"># Publishable table</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<table class="table table-condensed">
<thead>
<tr>
<th style="text-align:right;">
variable
</th>
<th style="text-align:right;">
frequencies
</th>
<th style="text-align:right;">
ratio
</th>
<th style="text-align:right;">
grade
</th>
<th style="text-align:right;">
cumulative
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
OpenGroup
</td>
<td style="text-align:right;">
13526
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
Bad
</td>
<td style="text-align:right;">
11
</td>
</tr>
<tr>
<td style="text-align:right;">
adj_close
</td>
<td style="text-align:right;">
13526
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
Bad
</td>
<td style="text-align:right;">
22
</td>
</tr>
<tr>
<td style="text-align:right;">
close
</td>
<td style="text-align:right;">
13526
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
Bad
</td>
<td style="text-align:right;">
33
</td>
</tr>
<tr>
<td style="text-align:right;">
date
</td>
<td style="text-align:right;">
13526
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
Bad
</td>
<td style="text-align:right;">
44
</td>
</tr>
<tr>
<td style="text-align:right;">
high
</td>
<td style="text-align:right;">
13526
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
Bad
</td>
<td style="text-align:right;">
56
</td>
</tr>
<tr>
<td style="text-align:right;">
low
</td>
<td style="text-align:right;">
13526
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
Bad
</td>
<td style="text-align:right;">
67
</td>
</tr>
<tr>
<td style="text-align:right;">
open
</td>
<td style="text-align:right;">
13526
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
Bad
</td>
<td style="text-align:right;">
78
</td>
</tr>
<tr>
<td style="text-align:right;">
stock_symbol
</td>
<td style="text-align:right;">
13526
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
Bad
</td>
<td style="text-align:right;">
89
</td>
</tr>
<tr>
<td style="text-align:right;">
volume
</td>
<td style="text-align:right;">
13526
</td>
<td style="text-align:right;">
0.3
</td>
<td style="text-align:right;">
Bad
</td>
<td style="text-align:right;">
100
</td>
</tr>
</tbody>

</table>
</div>
</div>
<ul>
<li>Plots showing the frequency of missing values</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the intersect of the columns with missing values</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This plot visualizes the table above</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>na.dataset <span class="sc">|&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_na_pareto</span>(<span class="at">only_na =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw02-04_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="advanced-exploration-of-missing-values-nas" class="level1">
<h1><strong>Advanced Exploration of Missing Values (NAs)</strong></h1>
<ul>
<li><p>Intersect plot that shows, for every combination of columns relevant, how many missing values are common</p></li>
<li><p>Orange boxes are the columns in question</p></li>
<li><p>x axis (top green bar plots) show the number of missing values in that column</p></li>
<li><p>y axis (right green bars) show the number of missing values in the columns in orange blocks</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the intersect of the 5 columns with the most missing values</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This means that some combinations of columns have missing values in the same row</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>na.dataset <span class="sc">|&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(high, low, close) <span class="sc">|&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_na_intersect</span>(<span class="at">only_na =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw02-04_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div></li>
</ul>
<section id="determining-if-na-observations-are-the-same" class="level2">
<h2 class="anchored" data-anchor-id="determining-if-na-observations-are-the-same"><strong>Determining if NA Observations are the Same</strong></h2>
<ul>
<li><p>Missing values can be the same observation across several columns, this is not shown above</p></li>
<li><p>The visdat package can solve this with the <code>vis_miss()</code> function which shows the rows with missing values through <code>ggplotly()</code></p></li>
<li><p>Here we will show ALL columns with NAs, and you can zoom into individual rows (interactive plot)</p></li>
<li><p>NOTE: This line will make the HTML rendering take a while…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interactive plotly() plot of all NA values to examine every row</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>na.dataset <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">select</span>(high, low, close) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">vis_miss</span>() <span class="sc">|&gt;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplotly</span>() </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># This is taking too much time and then failing, so I have set eval=FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></li>
</ul>
</section>
</section>
<section id="impute-outliers-and-nas" class="level1">
<h1><strong>Impute Outliers and NAs</strong></h1>
<p>Removing outliers and NAs can be tricky, but there are methods to do so. I will go over several, and discuss benefits and costs to each.</p>
<p>The principle goal for all imputation is to find the method that does not change the distribution too much (or oddly).</p>
<section id="classifying-outliers" class="level2">
<h2 class="anchored" data-anchor-id="classifying-outliers">Classifying Outliers</h2>
<p>Before imputing outliers, you will want to diagnose whether it’s they are natural outliers or not. We will be looking at “Close” for example across OpenGroup(mutated earlier), because there are outliers and several NAs, which we will impute below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Box plot</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>dataset <span class="sc">%&gt;%</span> <span class="co"># Set the simulated normal data as a data frame</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> close, <span class="at">y =</span> OpenGroup, <span class="at">fill =</span> OpenGroup)) <span class="sc">+</span> <span class="co"># Create a ggplot</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.5</span>, <span class="at">outlier.size =</span> <span class="dv">2</span>, <span class="at">outlier.alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Closing Price"</span>) <span class="sc">+</span>  <span class="co"># Relabel the x axis label</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"OpenGroup"</span>) <span class="sc">+</span> <span class="co"># Remove the y axis label</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)  <span class="co"># Remove the legend</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw02-04_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We remove outliers using imputate_outlier() and replace them with values that are estimates based on the existing data</p>
<p>mean: arithmetic mean</p>
<p>median: median</p>
<p>mode: mode</p>
<p>capping: Impute the upper outliers with 95 percentile, and impute the bottom outliers with 5 percentile - aka Winsorizing</p>
</section>
<section id="mean-imputation" class="level2">
<h2 class="anchored" data-anchor-id="mean-imputation">Mean Imputation</h2>
<p>The mean of the observed values for each variable is computed and the outliers for that variable are imputed by this mean</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Raw summary, output suppressed</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>mean_out_imp_close <span class="ot">&lt;-</span> dataset <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(close) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(close <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imputate_outlier</span>(close, <span class="at">method =</span> <span class="st">"mean"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Output showing the summary statistics of our imputation</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>mean_out_imp_close <span class="sc">|&gt;</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Impute outliers with mean

* Information of Imputation (before vs after)
                    Original Imputation
described_variables "value"  "value"   
n                   "13779"  "13779"   
na                  "0"      "0"       
mean                "209"    "187"     
sd                  "110"    " 68"     
se_mean             "0.94"   "0.58"    
IQR                 "111"    " 77"     
skewness            "1.8"    "1.1"     
kurtosis            "3.31"   "0.59"    
p00                 "100"    "100"     
p01                 "102"    "102"     
p05                 "110"    "110"     
p10                 "118"    "118"     
p20                 "131"    "131"     
p25                 "136"    "136"     
p30                 "141"    "141"     
p40                 "153"    "153"     
p50                 "167"    "167"     
p60                 "185"    "185"     
p70                 "222"    "209"     
p75                 "247"    "213"     
p80                 "275"    "238"     
p90                 "355"    "294"     
p95                 "476"    "336"     
p99                 "612"    "381"     
p100                "692"    "414"     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization of the mean imputation</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>mean_out_imp_close <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw02-04_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="median-imputation" class="level2">
<h2 class="anchored" data-anchor-id="median-imputation">Median Imputation</h2>
<p>The median of the observed values for each variable is computed and the outliers for that variable are imputed by this median</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Raw summary, output suppressed</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>median_out_imp_close <span class="ot">&lt;-</span> dataset <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(close) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(close <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imputate_outlier</span>(close, <span class="at">method =</span> <span class="st">"median"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Output showing the summary statistics of our imputation</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>median_out_imp_close <span class="sc">|&gt;</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Impute outliers with median

* Information of Imputation (before vs after)
                    Original Imputation
described_variables "value"  "value"   
n                   "13779"  "13779"   
na                  "0"      "0"       
mean                "209"    "184"     
sd                  "110"    " 68"     
se_mean             "0.94"   "0.58"    
IQR                 "111"    " 77"     
skewness            "1.8"    "1.2"     
kurtosis            "3.3"    "0.8"     
p00                 "100"    "100"     
p01                 "102"    "102"     
p05                 "110"    "110"     
p10                 "118"    "118"     
p20                 "131"    "131"     
p25                 "136"    "136"     
p30                 "141"    "141"     
p40                 "153"    "153"     
p50                 "167"    "167"     
p60                 "185"    "174"     
p70                 "222"    "192"     
p75                 "247"    "213"     
p80                 "275"    "238"     
p90                 "355"    "294"     
p95                 "476"    "336"     
p99                 "612"    "381"     
p100                "692"    "414"     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization of the mean imputation</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>median_out_imp_close <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw02-04_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="pros-cons-of-using-the-mean-or-median-imputation" class="level4">
<h4 class="anchored" data-anchor-id="pros-cons-of-using-the-mean-or-median-imputation">Pros &amp; Cons of Using the Mean or Median Imputation</h4>
<p><strong>Pros</strong>:</p>
<ul>
<li><p>Easy and fast.</p></li>
<li><p>Works well with small numerical datasets.</p></li>
</ul>
<p><strong>Cons</strong>:</p>
<ul>
<li><p>Doesn’t factor the correlations between variables. It only works on the column level.</p></li>
<li><p>Will give poor results on encoded categorical variables (do <strong>NOT</strong> use it on categorical variables).</p></li>
<li><p>Not very accurate.</p></li>
<li><p>Doesn’t account for the uncertainty in the imputations.</p></li>
</ul>
</section>
</section>
<section id="mode-imputation" class="level2">
<h2 class="anchored" data-anchor-id="mode-imputation">Mode Imputation</h2>
<p>The mode of the observed values for each variable is computed and the outliers for that variable are imputed by this mode</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Raw summary, output suppressed</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>mode_out_imp_close <span class="ot">&lt;-</span> dataset <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(close) <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(close <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imputate_outlier</span>(close, <span class="at">method =</span> <span class="st">"mode"</span>)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Output showing the summary statistics of our imputation</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>mode_out_imp_close <span class="sc">|&gt;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Impute outliers with mode

* Information of Imputation (before vs after)
                    Original Imputation
described_variables "value"  "value"   
n                   "13779"  "13779"   
na                  "0"      "0"       
mean                "209"    "180"     
sd                  "110"    " 71"     
se_mean             "0.94"   "0.60"    
IQR                 "111"    " 85"     
skewness            "1.8"    "1.2"     
kurtosis            "3.3"    "0.6"     
p00                 "100"    "100"     
p01                 "102"    "102"     
p05                 "110"    "105"     
p10                 "118"    "107"     
p20                 "131"    "122"     
p25                 "136"    "129"     
p30                 "141"    "134"     
p40                 "153"    "145"     
p50                 "167"    "157"     
p60                 "185"    "174"     
p70                 "222"    "192"     
p75                 "247"    "213"     
p80                 "275"    "238"     
p90                 "355"    "294"     
p95                 "476"    "336"     
p99                 "612"    "381"     
p100                "692"    "414"     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization of the mean imputation</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>mode_out_imp_close <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw02-04_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="pros-cons-of-using-the-mode-imputation" class="level4">
<h4 class="anchored" data-anchor-id="pros-cons-of-using-the-mode-imputation">Pros &amp; Cons of Using the Mode Imputation</h4>
<p><strong>Pros</strong>:</p>
<ul>
<li>Works well with categorical variables.</li>
</ul>
<p><strong>Cons</strong>:</p>
<ul>
<li><p>It also doesn’t factor the correlations between variables.</p></li>
<li><p>It can introduce bias in the data.</p></li>
</ul>
</section>
</section>
<section id="capping-imputation-aka-winsorizing" class="level2">
<h2 class="anchored" data-anchor-id="capping-imputation-aka-winsorizing"><strong>Capping Imputation (aka Winsorizing)</strong></h2>
<p>The Percentile Capping is a method of Imputing the outlier values by replacing those observations outside the lower limit with the value of 5th percentile and those that lie above the upper limit, with the value of 95th percentile of the same dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Raw summary, output suppressed</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>cap_out_imp_close <span class="ot">&lt;-</span> dataset <span class="sc">|&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(close) <span class="sc">|&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(close <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imputate_outlier</span>(close, <span class="at">method =</span> <span class="st">"capping"</span>)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Output showing the summary statistics of our imputation</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>cap_out_imp_close <span class="sc">|&gt;</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Impute outliers with capping

* Information of Imputation (before vs after)
                    Original Imputation
described_variables "value"  "value"   
n                   "13779"  "13779"   
na                  "0"      "0"       
mean                "209"    "206"     
sd                  "110"    "100"     
se_mean             "0.94"   "0.85"    
IQR                 "111"    "111"     
skewness            "1.8"    "1.4"     
kurtosis            "3.3"    "1.3"     
p00                 "100"    "100"     
p01                 "102"    "102"     
p05                 "110"    "110"     
p10                 "118"    "118"     
p20                 "131"    "131"     
p25                 "136"    "136"     
p30                 "141"    "141"     
p40                 "153"    "153"     
p50                 "167"    "167"     
p60                 "185"    "185"     
p70                 "222"    "222"     
p75                 "247"    "247"     
p80                 "275"    "275"     
p90                 "355"    "355"     
p95                 "476"    "476"     
p99                 "612"    "476"     
p100                "692"    "476"     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization of the mean imputation</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>cap_out_imp_close <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw02-04_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="pros-and-cons-of-capping" class="level4">
<h4 class="anchored" data-anchor-id="pros-and-cons-of-capping">Pros and Cons of Capping</h4>
<p><strong>Pros</strong>:</p>
<ul>
<li>Not influenced by extreme values</li>
</ul>
<p><strong>Cons</strong>:</p>
<ul>
<li><p>Capping only modifies the smallest and largest values slightly. This is generally not a good idea since it means we’re just modifying data values for the sake of modifications.</p></li>
<li><p>If no extreme outliers are present, Winsorization may be unnecessary.</p></li>
</ul>
</section>
</section>
<section id="imputing-nas" class="level2">
<h2 class="anchored" data-anchor-id="imputing-nas"><strong>Imputing NAs</strong></h2>
<ol type="1">
<li><p><code>knn</code>: K-nearest neighbors (KNN)</p></li>
<li><p><code>rpart</code>: Recursive Partitioning and Regression Trees (rpart)</p></li>
<li><p><code>mice</code>: Multivariate Imputation by Chained Equations (MICE)</p></li>
</ol>
<p>Since our normal <code>dataset</code> has no NA values, we will use the <code>na.dataset</code> we created earlier.</p>
<section id="k-nearest-neighbor-knn-imputation" class="level3">
<h3 class="anchored" data-anchor-id="k-nearest-neighbor-knn-imputation"><strong>K-Nearest Neighbor (KNN) Imputation</strong></h3>
<p>KNN is a machine learning algorithm that classifies data by similarity. This in effect clusters data into similar groups. The algorithm predicts values of new data to replace NA values based on how closely they resembles training data points, such as by comparing across other columns.</p>
<p>Here’s a visual example using the <code>clara()</code> function from the <code>cluster</code> package to run a KNN algorithm on our <code>dataset</code>, where three clusters are created by the algorithm.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># KNN plot of our dataset without categories</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">clara</span>(dataset[<span class="sc">-</span><span class="dv">5</span>], <span class="dv">3</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="hw02-04_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note that PC1 has 100%</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Raw summary, output suppressed</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>knn_na_imp_close <span class="ot">&lt;-</span> na.dataset <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imputate_na</span>(close, <span class="at">method =</span> <span class="st">"knn"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot showing the results of our imputation</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>knn_na_imp_close <span class="sc">|&gt;</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>knn imputation does not work here.</p>
<section id="pros-cons-of-using-knn-imputation" class="level4">
<h4 class="anchored" data-anchor-id="pros-cons-of-using-knn-imputation">Pros &amp; Cons of Using KNN Imputation</h4>
<p><strong>Pro</strong>:</p>
<ul>
<li>Possibly much more accurate than mean, median, or mode imputation for some data sets.</li>
</ul>
<p><strong>Cons</strong>:</p>
<ul>
<li><p>KNN is computationally expensive because it stores the entire training dataset into computer memory.</p></li>
<li><p>KNN is very sensitive to outliers, so you would have to imputate these first.</p></li>
</ul>
</section>
</section>
<section id="recursive-partitioning-and-regression-trees-rpart" class="level3">
<h3 class="anchored" data-anchor-id="recursive-partitioning-and-regression-trees-rpart"><strong>Recursive Partitioning and Regression Trees (rpart)</strong></h3>
<p>rpart is a decision tree machine learning algorithm that builds classification or regression models through a two stage process, which can be thought of as binary trees. The algorithm splits the data into subsets, which move down other branches of the tree until a termination criteria is reached.</p>
<p>For example, if we are missing a value for <code>OpenGroup</code> a first decision could be whether the associated <code>Close</code> is within a series of yes or no criteria</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Raw summary, output suppressed</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>rpart_na_imp_close <span class="ot">&lt;-</span> na.dataset <span class="sc">|&gt;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imputate_na</span>(close, <span class="at">method =</span> <span class="st">"rpart"</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot showing the results of our imputation</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>rpart_na_imp_insulin <span class="sc">|&gt;</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"># I am not able to use this imputation as well. I am unsure if it's because of the type of dataset that I have, as discussed in class.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="pros-cons-of-using-rpart-imputation" class="level4">
<h4 class="anchored" data-anchor-id="pros-cons-of-using-rpart-imputation">Pros &amp; Cons of Using rpart Imputation</h4>
<p><strong>Pros</strong>:</p>
<ul>
<li><p>Good for categorical data because approximations are easier to compare across categories than continuous variables.</p></li>
<li><p>Not sensitive to outliers.</p></li>
</ul>
<p><strong>Cons</strong>:</p>
<ul>
<li><p>Can over fit the data as they grow.</p></li>
<li><p>Speed decreases with more data columns.</p></li>
</ul>
</section>
</section>
<section id="multivariate-imputation-by-chained-equations-mice" class="level3">
<h3 class="anchored" data-anchor-id="multivariate-imputation-by-chained-equations-mice"><strong>Multivariate Imputation by Chained Equations (MICE)</strong></h3>
<p>MICE is an algorithm that fills missing values multiple times, hence dealing with uncertainty better than other methods. This approach creates multiple copies of the data that can then be analyzed and then pooled into a single dataset.</p>
<p>NOTE: You will have to set a random seed (e.g., 123) since the MICE algorithm pools several simulated imputations. Without setting a seed, a different result will occur after each simulation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>mice_na_imp_close <span class="ot">&lt;-</span> na.dataset <span class="sc">|&gt;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">imputate_na</span>(close, <span class="at">method =</span> <span class="st">"mice"</span>, <span class="at">seed =</span> <span class="dv">29</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># R studio is not loading the mice library</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot showing the results of our imputation</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>mice_na_imp_insulin <span class="sc">|&gt;</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="pros-cons-of-mice-imputation" class="level4">
<h4 class="anchored" data-anchor-id="pros-cons-of-mice-imputation">Pros &amp; Cons of MICE Imputation</h4>
<p><strong>Pros</strong>:</p>
<ul>
<li><p>Multiple imputations are more accurate than a single imputation.</p></li>
<li><p>The chained equations are very flexible to data types, such as categorical and ordinal.</p></li>
</ul>
<p><strong>Cons</strong>:</p>
<ul>
<li>You have to round the results for ordinal data because resulting data points are too great or too small (floating-points).</li>
</ul>
</section>
</section>
</section>
</section>
<section id="produce-an-html-transformation-summary" class="level1">
<h1>Produce an HTML Transformation Summary</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">transformation_web_report</span>(dataset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>